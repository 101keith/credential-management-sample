<!doctype html>
<!--
/*
 *
 * Copyright Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
-->
<html>
<head>
  <meta charset="utf-8">
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Credential Management API Sample</title>

  <meta name="google-signin-client_id" content="{{client_id}}">
  <script src="bower_components/fetch/fetch.js"></script>
  <script src="bower_components/webcomponentsjs/webcomponents-lite.min.js"></script>
  <script src="https://apis.google.com/js/platform.js"></script>
  <script src="https://connect.facebook.net/en_US/sdk.js"></script>

  <link rel="import" href="elements/elements.html">
  <link rel="shortcut icon" href="/favicon.png">
  <style>
    .paper-font-title {
      overflow: hidden;
      white-space: nowrap;
      text-overflow: ellipsis;
    }
    .profile img {
      width: 96px;
      height: 96px;
      clip-path: circle(50% at 50% 50%);
      -webkit-clip-path: circle(50% at 50% 50%);
      -moz-clip-path: circle(50% at 50% 50%);
      -o-clip-path: circle(50% at 50% 50%);
    }
    .gsignin img {
      cursor: pointer;
    }
    .fbsignin img {
      cursor: pointer;
      width: 186px;
      margin: 4px;
    }
    #toast {
      color: white;
    }
    iron-pages > div {
      margin: 0 16px;
    }
    paper-item {
      cursor: pointer;
    }
    paper-card {
      margin-top: 24px;
    }
    paper-card > * {
      padding: 0 24px 24px 24px;
    }
    .howto img {
      width: 100%;
      max-width: 300px;
    }
    .howto .left {
      float: left;
    }
  </style>
</head>

<body unresolved class="fullbleed layout vertical">
  <input id="csrf_token" type="hidden" name="csrf_token" value="{{csrf_token}}" />{% raw %}
  <template id="app" is="dom-bind">
    <paper-dialog id="dialog" modal>
      <paper-dialog-scrollable>
        <h2>Please sign-in</h2>
        <form is="iron-form" id="form" method="post">
          <paper-input id="lemail" name="email" label="email" autocomplete="email"></paper-input>
          <paper-input id="lpassword" type="password" name="password" label="password" autocomplete="password"></paper-input>
          <div class="buttons">
            <paper-button dialog-dismiss raised>Canel</paper-button>
            <paper-button on-tap="onPwSignIn" raised>Submit</paper-button>
          </div>
        </form>
        <div class="layout horizontal center-justified">
          <span>or</span>
        </div>
        <div class="gsignin" on-tap="onGSignIn">
          <img src="images/google_signin.png" />
        </div>
        <div class="fbsignin" on-tap="onFbSignIn">
          <img src="images/facebook_signin.png" />
        </div>
      </paper-dialog-scrollable>
    </paper-dialog>

    <paper-drawer-panel id="paperDrawerPanel">
      <!-- Drawer Scroll Header Panel -->
      <paper-scroll-header-panel drawer fixed>

        <!-- Drawer Toolbar -->
        <paper-toolbar id="drawerToolbar">
          <span class="paper-font-title">Menu</span>
        </paper-toolbar>
        <paper-menu class="content" selected="{{selected}}">
          <paper-item>Home</paper-item>
          <paper-item>How to use</paper-item>
          <template is="dom-if" if="[[userProfile]]">
            <paper-item on-tap="onUnregister">Remove account</paper-item>
          </template>
        </paper-menu>

      </paper-scroll-header-panel>

      <!-- Main Area -->
      <paper-header-panel main mode="seamed">

        <!-- Main Toolbar -->
        <paper-toolbar id="mainToolbar">
          <paper-icon-button id="paperToggle" icon="menu" paper-drawer-toggle>
          </paper-icon-button>
          <div class="flex title">
            Credential Management API Sample
          </div>

          <!-- Toolbar icons -->
          <template is="dom-if" if="[[!userProfile]]">
            <paper-button on-tap="openDialog" raised>
              Sign In
            </paper-button>
          </template>
          <template is="dom-if" if="[[userProfile]]">
            <paper-button on-tap="signOut" raised>Sign Out</paper-button>
          </template>
        </paper-toolbar>

        <!-- Main Content -->
        <div class="content">
          <iron-pages selected="{{selected}}">
            <div class="layout center vertical">
              <template is="dom-if" if="[[!cmaEnabled]]">
                <p>Credential Management API is not available on your browser.
                Try <a href="https://www.google.com/chrome/">Google Chrome 49 or
                later</a> and enable the flag at
                chrome://flags/#enable-credential-manager-api .
                </p>
              </template>
              <template is="dom-if" if="[[userProfile]]">
                <div class="profile layout center vertical">
                  <h2>Welcome! <span>[[userProfile.name]]</span></h2>
                  <div class="flex">
                    <img src="[[userProfile.imageUrl]]"/>
                  </div>
                </div>
              </template>
              <template is="dom-if" if="[[!userProfile]]">
                <paper-card heading="Sign-up now!">
                  <form is="iron-form" id="regForm" method="post">
                    <paper-input id="name" name="name" label="Your name">
                    </paper-input>
                    <paper-input id="email" name="email" label="Your email address">
                    </paper-input>
                    <paper-input id="password" type="password" name="password" label="Password">
                    </paper-input>
                    <div class="layout horizontal around-justified">
                      <paper-button on-tap="onRegister" raised>
                        Register
                      </paper-button>
                    </div>
                  </form>
                  <div class="layout horizontal center-justified">
                    <span>or</span>
                  </div>
                  <div class="gsignin" on-tap="onGSignIn">
                    <img src="images/google_signin.png" />
                  </div>
                  <div class="fbsignin" on-tap="onFbSignIn">
                    <img src="images/facebook_signin.png" />
                  </div>
                </paper-card>
              </template>
            </div>{% endraw %}
            <div class="layout vertical howto">

              <h2>What is this website?</h2>

              <p>This is a demo website of a standard-track proposal at the W3C - The <a href="https://w3c.github.io/webappsec-credential-management/">Credential Management API</a>. It helps developers with 3 aspects of user credentials enabling automatic sign-in.  </p>

              <ul>
              <li>Store and retrieve credentials (typically id and password)</li>
              <li>Store and retrieve federated account preference</li>
              <li>Store and retrieve preference of federation protocol (not implemented in Chrome yet)</li>
              </ul>

              <p>With this API, you can let users sign-in to your website without typing passwords, or forward the user to an IdP of choice.  </p>

              <h2>Prerequisite</h2>

              <p>You can try out the Credential Management API on Chrome version later than 50 with <code>chrome://flags/#enable-credential-manager-api</code> flag turned on. Signed-in to Chrome profile is preferred.  </p>

              <h2>How to experience</h2>

              <h3>Step 1. Sign up</h3>

              <img src="/images/howto/sign-up.png" alt="" title="" />
              <p>Open the page, enter name, email address and password and sign up (Beware, even though password is stored encrypted, please don't enter real ones).</p>

              <h3>Step 2. Save password</h3>

              <img src="/images/howto/save-password.png" alt="" title="" />
              <p>You will then be signed-in and browser asks you to store credential information to the password manager. Tap "Save" to store the credential. <br />
              You can find the saved credential information at <code>chrome://settings/passwords</code>.  </p>

              <h3>Step 3. The first sign-in</h3>

              <img src="/images/howto/the-first-sign-in.png" alt="" title="" />
              <p>Reload the page. You should be signed-out because this demo site doesn't keep sessions. Not auto-signed-in? Don't worry, this is expected. Tap "Sign-In". <br />
              You should see an account chooser dialog. Press the account you have just signed-up with.  </p>

              <h3>Step 4. Opt-in to Smart Lock</h3>

              <img src="/images/howto/opt-in-to-smart-lock.png" alt="" title="" />
              <p>You should now see a dialog asking if you want to opt-in to Google Smart Lock. This will enable the feature to be turned on for other sites as well. You can turn this off manually by going to <code>chrome://settings/passwords</code>.  </p>

              <h3>Step 5. Auto sign-in</h3>

              <img src="/images/howto/auto-sign-in.png" alt="" title="" />
              <p>Now, try reload the page again. You should now see at the bottom of the page that you are automatically signed-in using the account you have just signed-up with, as you have turned on the feature.  </p>

              <h3>Step 6. Sign out to enable the "mediation mode"</h3>

              <p>By signing out from the site by clicking on "Sign Out" brings you back to a signed out state. Try reload the page. You will notice that you won't be automatically signed-in. This is called the "mediation mode". The mediation mode prevents you from automatically sign-in. It's usually turned on when a user signs out on purpose. <br />
              By user proactively signing-in, the "mediation mode" will be turned off. Tap "Sign-In" again.  </p>

              <h3>Step 7. Add second account</h3>

              <img src="/images/howto/add-second-account.png" alt="" title="" />
              <p>At this time, instead of choosing an account, tap "Cancel". This will show you a login modal dialog. Choose "Sign-In with Google" (registration and login using Google Sign-In don't make any difference on this demo site). <br />
              A popup window should show up so you can sign-in by allowing profile access.  </p>

              <h3>Step 8. Auto-sign-in with 2 accounts?</h3>

              <img src="/images/howto/auto-sign-in-with-2-accounts.png" alt="" title="" />
              <p>Now you should be able to add the second account to the site. Let's reload the page without signing-out and see what happens? <br />
              OK, you are not automatically signed-in. This is because you have more than 1 account saved to the website. In this case, users have to explicitly tap on "Sign-In" and choose an account to sign-in with.  </p>

              <h3>Step 9. Try on different device</h3>

              <p>Now switch your device if you are signed-in to Chrome using a Google account. It could be another PC, Chromebook or another Android device - anywhere Google Chrome can run with the same profile.</p>

            </div>
          </iron-pages>
        </div>
      </paper-header-panel>
    </paper-drawer-panel>
    <paper-toast id="toast" duration="3000"></paper-toast>
  </template>

  <script src="scripts/app.js"></script>
</body>
</html>
